unsigned char _76_dump_sql[15608] = {
"CREATE VIEW sys.dump_create_roles AS\n"
"  SELECT\n"
"    'CREATE ROLE ' || sys.dq(name) || ';' stmt,\n"
"    name user_name\n"
"    FROM sys.auths\n"
"   WHERE name NOT IN (SELECT name FROM sys.db_user_info)\n"
"     AND grantor <> 0;\n"
"CREATE VIEW sys.dump_create_users AS\n"
"  SELECT\n"
"    'CREATE USER ' || sys.dq(ui.name) || ' WITH ENCRYPTED PASSWORD ' ||\n"
"      sys.sq(sys.password_hash(ui.name)) ||\n"
"      ' NAME ' || sys.sq(ui.fullname) || ' SCHEMA sys' || ifthenelse(ui.schema_path = '\"sys\"', '', ' SCHEMA PATH ' || sys.sq(ui.schema_path)) || ';' stmt,\n"
"    ui.name user_name\n"
"    FROM sys.db_user_info ui, sys.schemas s\n"
"   WHERE ui.default_schema = s.id\n"
"     AND ui.name <> 'monetdb'\n"
"     AND ui.name <> '.snapshot';\n"
"CREATE VIEW sys.dump_create_schemas AS\n"
"  SELECT\n"
"    'CREATE SCHEMA ' || sys.dq(s.name) || ifthenelse(a.name <> 'sysadmin', ' AUTHORIZATION ' || sys.dq(a.name), ' ') || ';' stmt,\n"
"    s.name schema_name\n"
"    FROM sys.schemas s, sys.auths a\n"
"   WHERE s.authorization = a.id AND s.system = FALSE;\n"
"CREATE VIEW sys.dump_add_schemas_to_users AS\n"
"  SELECT\n"
"    'ALTER USER ' || sys.dq(ui.name) || ' SET SCHEMA ' || sys.dq(s.name) || ';' stmt,\n"
"    s.name schema_name,\n"
"    ui.name user_name\n"
"    FROM sys.db_user_info ui, sys.schemas s\n"
"   WHERE ui.default_schema = s.id\n"
"     AND ui.name <> 'monetdb'\n"
"     AND ui.name <> '.snapshot'\n"
"     AND s.name <> 'sys';\n"
"CREATE VIEW sys.dump_grant_user_privileges AS\n"
"  SELECT\n"
"    'GRANT ' || sys.dq(a2.name) || ' ' || ifthenelse(a1.name = 'public', 'PUBLIC', sys.dq(a1.name)) || ';' stmt,\n"
"    a2.name grantee,\n"
"    a1.name grantor\n"
"    FROM sys.auths a1, sys.auths a2, sys.user_role ur\n"
"   WHERE a1.id = ur.login_id AND a2.id = ur.role_id;\n"
"CREATE VIEW sys.dump_table_constraint_type AS\n"
"  SELECT\n"
"    'ALTER TABLE ' || sys.FQN(sch, tbl) || ' ADD CONSTRAINT ' || sys.DQ(con) || ' '||\n"
"      tpe || ' (' || GROUP_CONCAT(sys.DQ(col), ', ') || ');' stmt,\n"
"    sch schema_name,\n"
"    tbl table_name,\n"
"    con constraint_name\n"
"    FROM sys.describe_constraints GROUP BY sch, tbl, con, tpe;\n"
"CREATE VIEW sys.dump_table_grants AS\n"
"  WITH table_grants (sname, tname, grantee, grants, grantor, grantable)\n"
"  AS (SELECT s.name, t.name, a.name, sum(p.privileges), g.name, p.grantable\n"
"	FROM sys.schemas s, sys.tables t, sys.auths a, sys.privileges p, sys.auths g\n"
"       WHERE p.obj_id = t.id AND p.auth_id = a.id AND t.schema_id = s.id AND t.system = FALSE AND p.grantor = g.id\n"
"       GROUP BY s.name, t.name, a.name, g.name, p.grantable\n"
"       ORDER BY s.name, t.name, a.name, g.name, p.grantable)\n"
"  SELECT\n"
"    'GRANT ' || pc.privilege_code_name || ' ON TABLE ' || sys.FQN(sname, tname)\n"
"      || ' TO ' || ifthenelse(grantee = 'public', 'PUBLIC', sys.dq(grantee))\n"
"      || CASE WHEN grantable = 1 THEN ' WITH GRANT OPTION' ELSE '' END || ';' stmt,\n"
"    sname schema_name,\n"
"    tname table_name,\n"
"    grantee\n"
"    FROM table_grants LEFT OUTER JOIN sys.privilege_codes pc ON grants = pc.privilege_code_id;\n"
"CREATE VIEW sys.dump_column_grants AS\n"
"  SELECT\n"
"    'GRANT ' || pc.privilege_code_name || '(' || sys.dq(c.name) || ') ON ' || sys.FQN(s.name, t.name)\n"
"      || ' TO ' || ifthenelse(a.name = 'public', 'PUBLIC', sys.dq(a.name))\n"
"      || CASE WHEN p.grantable = 1 THEN ' WITH GRANT OPTION' ELSE '' END || ';' stmt,\n"
"    s.name schema_name,\n"
"    t.name table_name,\n"
"    c.name column_name,\n"
"    a.name grantee\n"
"    FROM sys.schemas s,\n"
"	 sys.tables t,\n"
"	 sys.columns c,\n"
"	 sys.auths a,\n"
"	 sys.privileges p,\n"
"	 sys.auths g,\n"
"	 sys.privilege_codes pc\n"
"   WHERE p.obj_id = c.id\n"
"     AND c.table_id = t.id\n"
"     AND p.auth_id = a.id\n"
"     AND t.schema_id = s.id\n"
"     AND NOT t.system\n"
"     AND p.grantor = g.id\n"
"     AND p.privileges = pc.privilege_code_id\n"
"   ORDER BY s.name, t.name, c.name, a.name, g.name, p.grantable;\n"
"CREATE VIEW sys.dump_function_grants AS\n"
"  WITH func_args_all(func_id, number, max_number, func_arg) AS\n"
"  (SELECT a.func_id,\n"
"	  a.number,\n"
"	  max(a.number) OVER (PARTITION BY a.func_id ORDER BY a.number DESC),\n"
"	  group_concat(sys.describe_type(a.type, a.type_digits, a.type_scale), ', ') OVER (PARTITION BY a.func_id ORDER BY a.number)\n"
"     FROM sys.args a\n"
"    WHERE a.inout = 1),\n"
"  func_args(func_id, func_arg) AS\n"
"  (SELECT func_id, func_arg FROM func_args_all WHERE number = max_number)\n"
"  SELECT\n"
"    'GRANT ' || pc.privilege_code_name || ' ON ' || ft.function_type_keyword || ' '\n"
"      || sys.FQN(s.name, f.name) || '(' || coalesce(fa.func_arg, '') || ') TO '\n"
"      || ifthenelse(a.name = 'public', 'PUBLIC', sys.dq(a.name))\n"
"      || CASE WHEN p.grantable = 1 THEN ' WITH GRANT OPTION' ELSE '' END || ';' stmt,\n"
"    s.name schema_name,\n"
"    f.name function_name,\n"
"    a.name grantee\n"
"    FROM sys.schemas s,\n"
"	 sys.functions f LEFT OUTER JOIN func_args fa ON f.id = fa.func_id,\n"
"	 sys.auths a,\n"
"	 sys.privileges p,\n"
"	 sys.auths g,\n"
"	 sys.function_types ft,\n"
"	 sys.privilege_codes pc\n"
"   WHERE s.id = f.schema_id\n"
"     AND f.id = p.obj_id\n"
"     AND p.auth_id = a.id\n"
"     AND p.grantor = g.id\n"
"     AND p.privileges = pc.privilege_code_id\n"
"     AND f.type = ft.function_type_id\n"
"     AND NOT f.system\n"
"   ORDER BY s.name, f.name, a.name, g.name, p.grantable;\n"
"CREATE VIEW sys.dump_indices AS\n"
"  SELECT\n"
"    'CREATE ' || tpe || ' ' || sys.DQ(ind) || ' ON ' || sys.FQN(sch, tbl) || '(' || GROUP_CONCAT(col) || ');' stmt,\n"
"    sch schema_name,\n"
"    tbl table_name,\n"
"    ind index_name\n"
"    FROM sys.describe_indices GROUP BY ind, tpe, sch, tbl;\n"
"CREATE VIEW sys.dump_column_defaults AS\n"
"  SELECT 'ALTER TABLE ' || sys.FQN(sch, tbl) || ' ALTER COLUMN ' || sys.DQ(col) || ' SET DEFAULT ' || def || ';' stmt,\n"
"	 sch schema_name,\n"
"	 tbl table_name,\n"
"	 col column_name\n"
"    FROM sys.describe_column_defaults;\n"
"CREATE VIEW sys.dump_foreign_keys AS\n"
"  SELECT\n"
"    'ALTER TABLE ' || sys.FQN(fk_s, fk_t) || ' ADD CONSTRAINT ' || sys.DQ(fk) || ' ' ||\n"
"      'FOREIGN KEY(' || GROUP_CONCAT(sys.DQ(fk_c), ',') ||') ' ||\n"
"      'REFERENCES ' || sys.FQN(pk_s, pk_t) || '(' || GROUP_CONCAT(sys.DQ(pk_c), ',') || ') ' ||\n"
"      'ON DELETE ' || on_delete || ' ON UPDATE ' || on_update ||\n"
"      ';' stmt,\n"
"    fk_s foreign_schema_name,\n"
"    fk_t foreign_table_name,\n"
"    pk_s primary_schema_name,\n"
"    pk_t primary_table_name,\n"
"    fk key_name\n"
"    FROM sys.describe_foreign_keys GROUP BY fk_s, fk_t, pk_s, pk_t, fk, on_delete, on_update;\n"
"CREATE VIEW sys.dump_partition_tables AS\n"
"  SELECT\n"
"    'ALTER TABLE ' || sys.FQN(m_sch, m_tbl) || ' ADD TABLE ' || sys.FQN(p_sch, p_tbl) ||\n"
"      CASE\n"
"      WHEN tpe = 'VALUES' THEN ' AS PARTITION IN (' || pvalues || ')'\n"
"      WHEN tpe = 'RANGE' THEN ' AS PARTITION FROM ' || ifthenelse(minimum IS NOT NULL, sys.SQ(minimum), 'RANGE MINVALUE') || ' TO ' || ifthenelse(maximum IS NOT NULL, sys.SQ(maximum), 'RANGE MAXVALUE')\n"
"      WHEN tpe = 'FOR NULLS' THEN ' AS PARTITION FOR NULL VALUES'\n"
"      ELSE ''\n"
"      END ||\n"
"      CASE WHEN tpe in ('VALUES', 'RANGE') AND with_nulls THEN ' WITH NULL VALUES' ELSE '' END ||\n"
"      ';' stmt,\n"
"    m_sch merge_schema_name,\n"
"    m_tbl merge_table_name,\n"
"    p_sch partition_schema_name,\n"
"    p_tbl partition_table_name\n"
"    FROM sys.describe_partition_tables;\n"
"CREATE VIEW sys.dump_sequences AS\n"
"  SELECT\n"
"    'CREATE SEQUENCE ' || sys.FQN(sch, seq) || ' AS BIGINT;' stmt,\n"
"    sch schema_name,\n"
"    seq seqname\n"
"    FROM sys.describe_sequences;\n"
"CREATE VIEW sys.dump_start_sequences AS\n"
"  SELECT 'ALTER SEQUENCE ' || sys.FQN(sch, seq) ||\n"
"	   CASE WHEN s = 0 THEN '' ELSE ' RESTART WITH ' || rs END ||\n"
"	   CASE WHEN inc = 1 THEN '' ELSE ' INCREMENT BY ' || inc END ||\n"
"	   CASE WHEN nomin THEN ' NO MINVALUE' WHEN rmi IS NULL THEN '' ELSE ' MINVALUE ' || rmi END ||\n"
"	   CASE WHEN nomax THEN ' NO MAXVALUE' WHEN rma IS NULL THEN '' ELSE ' MAXVALUE ' || rma END ||\n"
"	   CASE WHEN \"cache\" = 1 THEN '' ELSE ' CACHE ' || \"cache\" END ||\n"
"	   CASE WHEN \"cycle\" THEN '' ELSE ' NO' END || ' CYCLE;' stmt,\n"
"    sch schema_name,\n"
"    seq sequence_name\n"
"    FROM sys.describe_sequences;\n"
"CREATE VIEW sys.dump_functions AS\n"
"  SELECT f.o o, sys.schema_guard(f.sch, f.fun, f.def) stmt,\n"
"	 f.sch schema_name,\n"
"	 f.fun function_name\n"
"    FROM sys.describe_functions f;\n"
"CREATE VIEW sys.dump_tables AS\n"
"  SELECT\n"
"    t.o o,\n"
"    CASE\n"
"      WHEN t.typ <> 'VIEW' THEN\n"
"      'CREATE ' || t.typ || ' ' || sys.FQN(t.sch, t.tab) || t.col || t.opt || ';'\n"
"      ELSE\n"
"      t.opt\n"
"      END stmt,\n"
"    t.sch schema_name,\n"
"    t.tab table_name\n"
"    FROM sys.describe_tables t;\n"
"CREATE VIEW sys.dump_triggers AS\n"
"  SELECT sys.schema_guard(sch, tab, def) stmt,\n"
"	 sch schema_name,\n"
"	 tab table_name,\n"
"	 tri trigger_name\n"
"    FROM sys.describe_triggers;\n"
"CREATE VIEW sys.dump_comments AS\n"
"  SELECT 'COMMENT ON ' || c.tpe || ' ' || c.fqn || ' IS ' || sys.SQ(c.rem) || ';' stmt FROM sys.describe_comments c;\n"
"CREATE VIEW sys.dump_user_defined_types AS\n"
"  SELECT 'CREATE TYPE ' || sys.FQN(sch, sql_tpe) || ' EXTERNAL NAME ' || sys.DQ(ext_tpe) || ';' stmt,\n"
"	 sch schema_name,\n"
"	 sql_tpe type_name\n"
"    FROM sys.describe_user_defined_types;\n"
"CREATE PROCEDURE sys.EVAL(stmt STRING) EXTERNAL NAME sql.eval;\n"
"CREATE FUNCTION sys.esc(s STRING) RETURNS STRING BEGIN RETURN '\"' || sys.replace(sys.replace(sys.replace(s,E'\\\\', E'\\\\\\\\'), E'\\n', E'\\\\n'), '\"', E'\\\\\"') || '\"'; END;\n"
"CREATE FUNCTION sys.prepare_esc(s STRING, t STRING) RETURNS STRING\n"
"BEGIN\n"
"  RETURN\n"
"    CASE\n"
"    WHEN (t = 'varchar' OR t ='char' OR t = 'clob' OR t = 'json' OR t = 'geometry' OR t = 'url') THEN\n"
"    'CASE WHEN ' || sys.DQ(s) || ' IS NULL THEN ''null'' ELSE ' || 'sys.esc(' || sys.DQ(s) || ')' || ' END'\n"
"    ELSE\n"
"    'CASE WHEN ' || sys.DQ(s) || ' IS NULL THEN ''null'' ELSE CAST(' || sys.DQ(s) || ' AS STRING) END'\n"
"    END;\n"
"END;\n"
"CREATE TABLE sys.dump_statements(o INT, s STRING);\n"
"CREATE PROCEDURE sys.dump_table_data(sch STRING, tbl STRING)\n"
"BEGIN\n"
"  DECLARE tid INT;\n"
"  SET tid = (SELECT MIN(t.id) FROM sys.tables t, sys.schemas s WHERE t.name = tbl AND t.schema_id = s.id AND s.name = sch);\n"
"  IF tid IS NOT NULL THEN\n"
"    DECLARE k INT;\n"
"    DECLARE m INT;\n"
"    SET k = (SELECT MIN(c.id) FROM sys.columns c WHERE c.table_id = tid);\n"
"    SET m = (SELECT MAX(c.id) FROM sys.columns c WHERE c.table_id = tid);\n"
"    IF k IS NOT NULL AND m IS NOT NULL THEN\n"
"      DECLARE cname STRING;\n"
"      DECLARE ctype STRING;\n"
"      DECLARE _cnt INT;\n"
"      SET cname = (SELECT c.name FROM sys.columns c WHERE c.id = k);\n"
"      SET ctype = (SELECT c.type FROM sys.columns c WHERE c.id = k);\n"
"      SET _cnt = (SELECT count FROM sys.storage(sch, tbl, cname));\n"
"      IF _cnt > 0 THEN\n"
"        DECLARE COPY_INTO_STMT STRING;\n"
"        DECLARE SELECT_DATA_STMT STRING;\n"
"        SET COPY_INTO_STMT = 'COPY ' || _cnt || ' RECORDS INTO ' || sys.FQN(sch, tbl) || '(' || sys.DQ(cname);\n"
"        SET SELECT_DATA_STMT = 'SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), ' || sys.prepare_esc(cname, ctype);\n"
"        WHILE (k < m) DO\n"
"          SET k = (SELECT MIN(c.id) FROM sys.columns c WHERE c.table_id = tid AND c.id > k);\n"
"          SET cname = (SELECT c.name FROM sys.columns c WHERE c.id = k);\n"
"          SET ctype = (SELECT c.type FROM sys.columns c WHERE c.id = k);\n"
"          SET COPY_INTO_STMT = (COPY_INTO_STMT || ', ' || sys.DQ(cname));\n"
"          SET SELECT_DATA_STMT = (SELECT_DATA_STMT || '|| ''|'' || ' || sys.prepare_esc(cname, ctype));\n"
"        END WHILE;\n"
"        SET COPY_INTO_STMT = (COPY_INTO_STMT || R') FROM STDIN USING DELIMITERS ''|'',E''\\n'',''\"'';');\n"
"        SET SELECT_DATA_STMT = (SELECT_DATA_STMT || ' FROM ' || sys.FQN(sch, tbl));\n"
"        INSERT INTO sys.dump_statements VALUES ((SELECT COUNT(*) FROM sys.dump_statements) + 1, COPY_INTO_STMT);\n"
"        CALL sys.EVAL('INSERT INTO sys.dump_statements ' || SELECT_DATA_STMT || ';');\n"
"      END IF;\n"
"    END IF;\n"
"  END IF;\n"
"END;\n"
"CREATE PROCEDURE sys.dump_table_data()\n"
"BEGIN\n"
"  DECLARE i INT;\n"
"  SET i = (SELECT MIN(t.id) FROM sys.tables t, sys.table_types ts WHERE t.type = ts.table_type_id AND ts.table_type_name = 'TABLE' AND NOT t.system);\n"
"  IF i IS NOT NULL THEN\n"
"    DECLARE M INT;\n"
"    SET M = (SELECT MAX(t.id) FROM sys.tables t, sys.table_types ts WHERE t.type = ts.table_type_id AND ts.table_type_name = 'TABLE' AND NOT t.system);\n"
"    DECLARE sch STRING;\n"
"    DECLARE tbl STRING;\n"
"    WHILE i IS NOT NULL AND i <= M DO\n"
"      SET sch = (SELECT s.name FROM sys.tables t, sys.schemas s WHERE s.id = t.schema_id AND t.id = i);\n"
"      SET tbl = (SELECT t.name FROM sys.tables t, sys.schemas s WHERE s.id = t.schema_id AND t.id = i);\n"
"      CALL sys.dump_table_data(sch, tbl);\n"
"      SET i = (SELECT MIN(t.id) FROM sys.tables t, sys.table_types ts WHERE t.type = ts.table_type_id AND ts.table_type_name = 'TABLE' AND NOT t.system AND t.id > i);\n"
"    END WHILE;\n"
"  END IF;\n"
"END;\n"
"CREATE FUNCTION sys.dump_database(describe BOOLEAN) RETURNS TABLE(o int, stmt STRING)\n"
"BEGIN\n"
"  SET SCHEMA sys;\n"
"  TRUNCATE sys.dump_statements;\n"
"  INSERT INTO sys.dump_statements VALUES (1, 'START TRANSACTION;');\n"
"  INSERT INTO sys.dump_statements VALUES (2, 'SET SCHEMA \"sys\";');\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_create_roles;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_create_users;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_create_schemas;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_user_defined_types;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_add_schemas_to_users;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_grant_user_privileges;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_sequences;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(ORDER BY stmts.o), stmts.s\n"
"				    FROM (\n"
"				      SELECT f.o, f.stmt FROM sys.dump_functions f\n"
"				       UNION ALL\n"
"				      SELECT t.o, t.stmt FROM sys.dump_tables t\n"
"				    ) AS stmts(o, s);\n"
"  IF NOT DESCRIBE THEN\n"
"    CALL sys.dump_table_data();\n"
"  END IF;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_start_sequences;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_column_defaults;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_table_constraint_type;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_indices;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_foreign_keys;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_partition_tables;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_triggers;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_comments;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_table_grants;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_column_grants;\n"
"  INSERT INTO sys.dump_statements SELECT (SELECT COUNT(*) FROM sys.dump_statements) + RANK() OVER(), stmt FROM sys.dump_function_grants;\n"
"  INSERT INTO sys.dump_statements VALUES ((SELECT COUNT(*) FROM sys.dump_statements) + 1, 'COMMIT;');\n"
"  RETURN sys.dump_statements;\n"
"END;\n"
};
#include "monetdb_config.h"
#include "sql_import.h"
#ifdef _MSC_VER
#undef read
#pragma section(".CRT$XCU",read)
#endif
LIB_STARTUP_FUNC(init_76_dump_sql)
{ sql_register("76_dump", _76_dump_sql); }
