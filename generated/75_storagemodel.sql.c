unsigned char _75_storagemodel_sql[7486] = {
"create function sys.\"storage\"()\n"
"returns table (\n"
"	\"schema\" varchar(1024),\n"
"	\"table\" varchar(1024),\n"
"	\"column\" varchar(1024),\n"
"	\"type\" varchar(1024),\n"
"	\"mode\" varchar(15),\n"
"	location varchar(1024),\n"
"	\"count\" bigint,\n"
"	typewidth int,\n"
"	columnsize bigint,\n"
"	heapsize bigint,\n"
"	hashes bigint,\n"
"	phash boolean,\n"
"	\"imprints\" bigint,\n"
"	sorted boolean,\n"
"	revsorted boolean,\n"
"	\"unique\" boolean,\n"
"	orderidx bigint\n"
")\n"
"external name sql.\"storage\";\n"
"create view sys.\"storage\" as\n"
"select * from sys.\"storage\"()\n"
" where (\"schema\", \"table\") in (\n"
"	SELECT sch.\"name\", tbl.\"name\"\n"
"	  FROM sys.\"tables\" AS tbl JOIN sys.\"schemas\" AS sch ON tbl.schema_id = sch.id\n"
"	 WHERE tbl.\"system\" = FALSE)\n"
"order by \"schema\", \"table\", \"column\";\n"
"create view sys.\"tablestorage\" as\n"
"select \"schema\", \"table\",\n"
"	max(\"count\") as \"rowcount\",\n"
"	count(*) as \"storages\",\n"
"	sum(columnsize) as columnsize,\n"
"	sum(heapsize) as heapsize,\n"
"	sum(hashes) as hashsize,\n"
"	sum(\"imprints\") as imprintsize,\n"
"	sum(orderidx) as orderidxsize\n"
" from sys.\"storage\"\n"
"group by \"schema\", \"table\"\n"
"order by \"schema\", \"table\";\n"
"create view sys.\"schemastorage\" as\n"
"select \"schema\",\n"
"	count(*) as \"storages\",\n"
"	sum(columnsize) as columnsize,\n"
"	sum(heapsize) as heapsize,\n"
"	sum(hashes) as hashsize,\n"
"	sum(\"imprints\") as imprintsize,\n"
"	sum(orderidx) as orderidxsize\n"
" from sys.\"storage\"\n"
"group by \"schema\"\n"
"order by \"schema\";\n"
"create function sys.\"storage\"(sname varchar(1024))\n"
"returns table (\n"
"	\"schema\" varchar(1024),\n"
"	\"table\" varchar(1024),\n"
"	\"column\" varchar(1024),\n"
"	\"type\" varchar(1024),\n"
"	\"mode\" varchar(15),\n"
"	location varchar(1024),\n"
"	\"count\" bigint,\n"
"	typewidth int,\n"
"	columnsize bigint,\n"
"	heapsize bigint,\n"
"	hashes bigint,\n"
"	phash boolean,\n"
"	\"imprints\" bigint,\n"
"	sorted boolean,\n"
"	revsorted boolean,\n"
"	\"unique\" boolean,\n"
"	orderidx bigint\n"
")\n"
"external name sql.\"storage\";\n"
"create function sys.\"storage\"(sname varchar(1024), tname varchar(1024))\n"
"returns table (\n"
"	\"schema\" varchar(1024),\n"
"	\"table\" varchar(1024),\n"
"	\"column\" varchar(1024),\n"
"	\"type\" varchar(1024),\n"
"	\"mode\" varchar(15),\n"
"	location varchar(1024),\n"
"	\"count\" bigint,\n"
"	typewidth int,\n"
"	columnsize bigint,\n"
"	heapsize bigint,\n"
"	hashes bigint,\n"
"	phash boolean,\n"
"	\"imprints\" bigint,\n"
"	sorted boolean,\n"
"	revsorted boolean,\n"
"	\"unique\" boolean,\n"
"	orderidx bigint\n"
")\n"
"external name sql.\"storage\";\n"
"create function sys.\"storage\"(sname varchar(1024), tname varchar(1024), cname varchar(1024))\n"
"returns table (\n"
"	\"schema\" varchar(1024),\n"
"	\"table\" varchar(1024),\n"
"	\"column\" varchar(1024),\n"
"	\"type\" varchar(1024),\n"
"	\"mode\" varchar(15),\n"
"	location varchar(1024),\n"
"	\"count\" bigint,\n"
"	typewidth int,\n"
"	columnsize bigint,\n"
"	heapsize bigint,\n"
"	hashes bigint,\n"
"	phash boolean,\n"
"	\"imprints\" bigint,\n"
"	sorted boolean,\n"
"	revsorted boolean,\n"
"	\"unique\" boolean,\n"
"	orderidx bigint\n"
")\n"
"external name sql.\"storage\";\n"
"create table sys.storagemodelinput(\n"
"	\"schema\" varchar(1024) NOT NULL,\n"
"	\"table\" varchar(1024) NOT NULL,\n"
"	\"column\" varchar(1024) NOT NULL,\n"
"	\"type\" varchar(1024) NOT NULL,\n"
"	typewidth int NOT NULL,\n"
"	\"count\" bigint NOT NULL,\n"
"	\"distinct\" bigint NOT NULL,\n"
"	atomwidth int NOT NULL,\n"
"	reference boolean NOT NULL DEFAULT FALSE,\n"
"	sorted boolean,\n"
"	\"unique\" boolean,\n"
"	isacolumn boolean NOT NULL DEFAULT TRUE\n"
");\n"
"create procedure sys.storagemodelinit()\n"
"begin\n"
"	delete from sys.storagemodelinput;\n"
"	insert into sys.storagemodelinput\n"
"	select \"schema\", \"table\", \"column\", \"type\", typewidth, \"count\",\n"
"		case when (\"unique\" or \"type\" IN ('varchar', 'char', 'clob', 'json', 'url', 'blob', 'geometry', 'geometrya'))\n"
"			then \"count\" else 0 end,\n"
"		case when \"count\" > 0 and heapsize >= 8192 and \"type\" in ('varchar', 'char', 'clob', 'json', 'url')\n"
"			then cast((heapsize - 8192) / \"count\" as bigint)\n"
"		when \"count\" > 0 and heapsize >= 32 and \"type\" in ('blob', 'geometry', 'geometrya')\n"
"			then cast((heapsize - 32) / \"count\" as bigint)\n"
"		else typewidth end,\n"
"		FALSE, case sorted when true then true else false end, \"unique\", TRUE\n"
"	  from sys.\"storage\";\n"
"	update sys.storagemodelinput\n"
"	   set reference = TRUE\n"
"	 where (\"schema\", \"table\", \"column\") in (\n"
"		SELECT fkschema.\"name\", fktable.\"name\", fkkeycol.\"name\"\n"
"		  FROM	sys.\"keys\" AS fkkey,\n"
"			sys.\"objects\" AS fkkeycol,\n"
"			sys.\"tables\" AS fktable,\n"
"			sys.\"schemas\" AS fkschema\n"
"		WHERE fktable.\"id\" = fkkey.\"table_id\"\n"
"		  AND fkkey.\"id\" = fkkeycol.\"id\"\n"
"		  AND fkschema.\"id\" = fktable.\"schema_id\"\n"
"		  AND fkkey.\"rkey\" > -1 );\n"
"	update sys.storagemodelinput\n"
"	   set isacolumn = FALSE\n"
"	 where (\"schema\", \"table\", \"column\") NOT in (\n"
"		SELECT sch.\"name\", tbl.\"name\", col.\"name\"\n"
"		  FROM sys.\"schemas\" AS sch,\n"
"			sys.\"tables\" AS tbl,\n"
"			sys.\"columns\" AS col\n"
"		WHERE sch.\"id\" = tbl.\"schema_id\"\n"
"		  AND tbl.\"id\" = col.\"table_id\");\n"
"end;\n"
"create function sys.columnsize(tpe varchar(1024), count bigint)\n"
"returns bigint\n"
"begin\n"
"	if tpe in ('tinyint', 'boolean')\n"
"		then return count;\n"
"	end if;\n"
"	if tpe = 'smallint'\n"
"		then return 2 * count;\n"
"	end if;\n"
"	if tpe in ('int', 'real', 'date', 'time', 'timetz', 'sec_interval', 'day_interval', 'month_interval')\n"
"		then return 4 * count;\n"
"	end if;\n"
"	if tpe in ('bigint', 'double', 'timestamp', 'timestamptz', 'inet', 'oid')\n"
"		then return 8 * count;\n"
"	end if;\n"
"	if tpe in ('hugeint', 'decimal', 'uuid', 'mbr')\n"
"		then return 16 * count;\n"
"	end if;\n"
"	if tpe in ('varchar', 'char', 'clob', 'json', 'url')\n"
"		then return 4 * count;\n"
"	end if;\n"
"	if tpe in ('blob', 'geometry', 'geometrya')\n"
"		then return 8 * count;\n"
"	end if;\n"
"	return 8 * count;\n"
"end;\n"
"create function sys.heapsize(tpe varchar(1024), count bigint, distincts bigint, avgwidth int)\n"
"returns bigint\n"
"begin\n"
"	if tpe in ('varchar', 'char', 'clob', 'json', 'url')\n"
"		then return 8192 + ((avgwidth + 8) * distincts);\n"
"	end if;\n"
"	if tpe in ('blob', 'geometry', 'geometrya')\n"
"		then return 32 + (avgwidth * count);\n"
"	end if;\n"
"	return 0;\n"
"end;\n"
"create function sys.hashsize(b boolean, count bigint)\n"
"returns bigint\n"
"begin\n"
"	if b = true\n"
"		then return 8 * count;\n"
"	end if;\n"
"	return 0;\n"
"end;\n"
"create function sys.imprintsize(tpe varchar(1024), count bigint)\n"
"returns bigint\n"
"begin\n"
"	if tpe in ('tinyint', 'boolean')\n"
"		then return cast(0.2 * count as bigint);\n"
"	end if;\n"
"	if tpe = 'smallint'\n"
"		then return cast(0.4 * count as bigint);\n"
"	end if;\n"
"	if tpe in ('int', 'real', 'date', 'time', 'timetz', 'sec_interval', 'day_interval', 'month_interval')\n"
"		then return cast(0.8 * count as bigint);\n"
"	end if;\n"
"	if tpe in ('bigint', 'double', 'timestamp', 'timestamptz', 'inet', 'oid')\n"
"		then return cast(1.6 * count as bigint);\n"
"	end if;\n"
"	if tpe in ('hugeint', 'decimal', 'uuid', 'mbr')\n"
"		then return cast(3.2 * count as bigint);\n"
"	end if;\n"
"	return 0;\n"
"end;\n"
"create view sys.storagemodel as\n"
"select \"schema\", \"table\", \"column\", \"type\", \"count\",\n"
"	sys.columnsize(\"type\", \"count\") as columnsize,\n"
"	sys.heapsize(\"type\", \"count\", \"distinct\", \"atomwidth\") as heapsize,\n"
"	sys.hashsize(\"reference\", \"count\") as hashsize,\n"
"	case when isacolumn then sys.imprintsize(\"type\", \"count\") else 0 end as imprintsize,\n"
"	case when (isacolumn and not sorted) then cast(8 * \"count\" as bigint) else 0 end as orderidxsize,\n"
"	sorted, \"unique\", isacolumn\n"
" from sys.storagemodelinput\n"
"order by \"schema\", \"table\", \"column\";\n"
"create view sys.tablestoragemodel as\n"
"select \"schema\", \"table\",\n"
"	max(\"count\") as \"rowcount\",\n"
"	count(*) as \"storages\",\n"
"	sum(sys.columnsize(\"type\", \"count\")) as columnsize,\n"
"	sum(sys.heapsize(\"type\", \"count\", \"distinct\", \"atomwidth\")) as heapsize,\n"
"	sum(sys.hashsize(\"reference\", \"count\")) as hashsize,\n"
"	sum(case when isacolumn then sys.imprintsize(\"type\", \"count\") else 0 end) as imprintsize,\n"
"	sum(case when (isacolumn and not sorted) then cast(8 * \"count\" as bigint) else 0 end) as orderidxsize\n"
" from sys.storagemodelinput\n"
"group by \"schema\", \"table\"\n"
"order by \"schema\", \"table\";\n"
};
#include "monetdb_config.h"
#include "sql_import.h"
#ifdef _MSC_VER
#undef read
#pragma section(".CRT$XCU",read)
#endif
LIB_STARTUP_FUNC(init_75_storagemodel_sql)
{ sql_register("75_storagemodel", _75_storagemodel_sql); }
